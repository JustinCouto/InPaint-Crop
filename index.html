<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Inpainting & Cropping Tool</title>
  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#222">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="icon" type="image/png" href="icon-192.png">
</head>
<body>
  <input type="file" id="fileInput" accept="image/*" style="display: none;">
  <header>
    <div class="topbar">
      <h1>Inpainting & Cropping Tool</h1>
    </div>

    <p class="note">
      Upload an image and use the toolbar to select areas to edit or crop the image.
    </p>

    <div class="controls" role="toolbar" aria-label="Inpainting tools">    

      <button id="cursorTool" class="icon-btn" title="Inpainting Brush">
        <svg viewBox="0 0 297 297" aria-hidden="true">
          <path d="M249.774,121.802l-0.008-111.81c0-5.513-4.469-9.981-9.98-9.981h-33.201c-4.297,0-8.111,2.749-9.469,6.825l-7.125,21.375 l-7.137-21.383c-1.359-4.073-5.172-6.821-9.467-6.821L57.198,0c-0.002,0-0.002,0-0.002,0c-2.646,0-5.186,1.052-7.057,2.923 c-1.873,1.873-2.924,4.412-2.924,7.059l0.008,111.813c-1.287,0.934-2.514,1.972-3.662,3.119c-5.666,5.666-8.785,13.18-8.785,21.155 v9.836c0.002,16.512,13.436,29.944,29.945,29.944l47.756,0.004l0.002,75.129c-0.002,9.622,3.746,18.668,10.553,25.471 c6.805,6.801,15.852,10.547,25.473,10.547c0.004,0,0.008,0,0.012,0c9.621,0,18.666-3.744,25.469-10.544 c6.807-6.804,10.555-15.851,10.549-25.472l-0.004-75.126l47.75,0.004l0,0c7.976,0,15.49-3.121,21.156-8.787 c5.668-5.667,8.787-13.181,8.787-21.156v-9.84C262.222,136.098,257.306,127.245,249.774,121.802z M67.187,116.125l-0.008-96.161 l9.566,0.001v45.79c0,5.513,4.471,9.981,9.982,9.981c5.512,0,9.981-4.469,9.981-9.981V19.966l13.738,0.001v68.236 c0,5.513,4.469,9.982,9.98,9.982c5.514,0,9.982-4.47,9.982-9.982V19.969h10.93v23.33c0,5.512,4.469,9.981,9.98,9.981 c5.512,0,9.982-4.47,9.982-9.981V19.971h4.893l14.334,42.95c1.361,4.074,5.174,6.822,9.471,6.821 c4.295-0.001,8.109-2.75,9.467-6.825l14.314-42.942h16.025l0.004,96.159L67.187,116.125z M164.571,260.99 c0.002,4.286-1.666,8.316-4.699,11.347c-3.033,3.031-7.064,4.7-11.359,4.7c-0.002,0-0.004,0-0.004,0 c-4.295,0-8.33-1.671-11.363-4.703c-3.033-3.031-4.703-7.063-4.703-11.351l-0.002-75.129l32.127,0.003L164.571,260.99z M232.286,136.099c5.5,0.005,9.973,4.481,9.975,9.981v9.84c0,2.644-1.045,5.144-2.939,7.04c-1.896,1.895-4.396,2.939-7.039,2.939 l-167.559-0.013c-5.504,0-9.982-4.479-9.984-9.982v-9.836c0-2.644,1.045-5.145,2.939-7.04c1.896-1.896,4.396-2.939,7.041-2.939 L232.286,136.099z" fill="currentColor"/>
        </svg>
      </button>

      <label class="brush" title="Adjust brush size">
        <span>Brush</span>
        <input type="range" id="brushSize" min="1" max="128" step="1" value="65">
        <span id="brushReadout" aria-live="polite">65px</span>
      </label>

      <!-- Undo/Redo group that wraps together -->
      <div class="icon-group-wrap">
        <button id="undoMask" class="icon-btn" title="Undo inpainting stroke" disabled>
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M3 7v6h6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>

        <button id="redoMask" class="icon-btn" title="Redo inpainting stroke" disabled>
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M21 7v6h-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3L21 13" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </button>
      </div>

      <!-- Other tools group -->
      <div class="icon-group-wrap">
        <button id="zoomIn" class="icon-btn" title="Zoom in (click image to zoom)">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M21 21l-4.35-4.35" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M11 8v6M8 11h6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>

        <button id="zoomReset" class="icon-btn zoom-reset-btn" title="Reset zoom to 100%">
          <svg viewBox="0 0 36 24" aria-hidden="true">
            <text x="18" y="17" text-anchor="middle" font-size="15" font-weight="900" fill="currentColor" font-family="ui-sans-serif, system-ui, -apple-system, sans-serif">100%</text>
          </svg>
        </button>

        <button id="zoomOut" class="icon-btn" title="Zoom out (click image to zoom out)">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <circle cx="11" cy="11" r="7" fill="none" stroke="currentColor" stroke-width="2"/>
            <path d="M21 21l-4.35-4.35" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M8 11h6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>

        <button id="cropTool" class="icon-btn" title="Crop (drag to select area)">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <path d="M6 2v4H2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M18 22v-4h4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <rect x="7" y="7" width="10" height="10" fill="none" stroke="currentColor" stroke-width="2"/>
          </svg>
        </button>

        <button id="promptAi" class="icon-btn" title="Generate AI Prompt">
          <svg viewBox="0 0 24 24" aria-hidden="true">
            <text x="12" y="17" text-anchor="middle" font-size="15" font-weight="900" fill="currentColor" font-family="ui-sans-serif, system-ui, -apple-system, sans-serif">AI</text>
          </svg>
        </button>
      </div>
    </div>
  </header>

  <main>
    <div id="canvasContainer">
      <div class="placeholder-prompt">        
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span>Select an image from your device...</span>
      </div>
      <canvas id="mainCanvas"></canvas>
      <canvas id="maskCanvas"></canvas>
      <canvas id="uiCanvas" aria-hidden="true"></canvas>
    </div>
    <div class="version-label" id="versionLabel"></div>
    <button id="clearImage" class="trash-btn" title="Clear image and start over">
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path d="M3 6h18M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        <path d="M10 11v6M14 11v6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </button>
  </main>

  <!-- AI Menu (replaces dialog) -->
  <div id="aiMenu" class="ai-menu" style="display: none;">
    <div class="ai-menu-content">
      <!-- Remove Section -->
      <section class="ai-menu-section">
        <h3 class="ai-section-title">Remove Painted Area</h3>
        <div class="ai-icon-buttons">
          <button type="button" class="ai-icon-btn" data-action="remove-prompt" title="Copy prompt only">
            <svg viewBox="0 0 48 48" aria-hidden="true" class="ai-icon">
              <!-- Squiggly lines icon -->
              <path d="M8 12 Q 14 8, 20 12 T 32 12 T 44 12" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <path d="M8 20 Q 14 16, 20 20 T 32 20 T 44 20" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <path d="M8 28 Q 14 24, 20 28 T 32 28 T 44 28" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <path d="M8 36 Q 14 32, 20 36 T 32 36 T 44 36" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
            </svg>
            <span class="ai-icon-label">Copy Prompt</span>
          </button>
          
          <button type="button" class="ai-icon-btn" data-action="remove-image" title="Copy image only">
            <svg viewBox="0 0 48 48" aria-hidden="true" class="ai-icon">
              <!-- Sun with rays icon -->
              <circle cx="24" cy="16" r="6" fill="currentColor"/>
              <line x1="24" y1="6" x2="24" y2="2" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <line x1="30.5" y1="9.5" x2="33.5" y2="6.5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <line x1="34" y1="16" x2="38" y2="16" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <line x1="30.5" y1="22.5" x2="33.5" y2="25.5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <line x1="17.5" y1="9.5" x2="14.5" y2="6.5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <line x1="14" y1="16" x2="10" y2="16" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <line x1="17.5" y1="22.5" x2="14.5" y2="25.5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <!-- Mountain/image indicator -->
              <rect x="6" y="30" width="36" height="14" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
              <path d="M6 44 L 14 36 L 22 40 L 30 32 L 42 42" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="ai-icon-label">Copy Image</span>
          </button>
          
          <button type="button" class="ai-icon-btn" data-action="remove-both" title="Copy prompt and image">
            <svg viewBox="0 0 48 48" aria-hidden="true" class="ai-icon">
              <!-- Combined: sun + squiggly lines -->
              <circle cx="30" cy="10" r="4" fill="currentColor"/>
              <line x1="30" y1="3" x2="30" y2="1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="34.5" y1="5.5" x2="36.5" y2="3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="37" y1="10" x2="39" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="25.5" y1="5.5" x2="23.5" y2="3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="23" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M6 22 Q 10 19, 14 22 T 22 22 T 30 22" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <path d="M6 28 Q 10 25, 14 28 T 22 28 T 30 28" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <path d="M6 34 Q 10 31, 14 34 T 22 34 T 30 34" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <path d="M6 40 Q 10 37, 14 40 T 22 40 T 30 40" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
            </svg>
            <span class="ai-icon-label">Copy Both</span>
          </button>
        </div>
      </section>

      <!-- Divider -->
      <div class="ai-menu-divider"></div>

      <!-- Replace Section -->
      <section class="ai-menu-section">
        <h3 class="ai-section-title">Replace Painted Area</h3>
        <textarea 
          id="replaceText" 
          class="ai-replace-textarea" 
          placeholder="Describe what you want to replace the painted area with..."
          rows="3"
        ></textarea>
        <div class="ai-icon-buttons">
          <button type="button" class="ai-icon-btn" data-action="replace-prompt" title="Copy prompt only">
            <svg viewBox="0 0 48 48" aria-hidden="true" class="ai-icon">
              <!-- Squiggly lines icon -->
              <path d="M8 12 Q 14 8, 20 12 T 32 12 T 44 12" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <path d="M8 20 Q 14 16, 20 20 T 32 20 T 44 20" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <path d="M8 28 Q 14 24, 20 28 T 32 28 T 44 28" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <path d="M8 36 Q 14 32, 20 36 T 32 36 T 44 36" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
            </svg>
            <span class="ai-icon-label">Copy Prompt</span>
          </button>
          
          <button type="button" class="ai-icon-btn" data-action="replace-image" title="Copy image only">
            <svg viewBox="0 0 48 48" aria-hidden="true" class="ai-icon">
              <!-- Sun with rays icon -->
              <circle cx="24" cy="16" r="6" fill="currentColor"/>
              <line x1="24" y1="6" x2="24" y2="2" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <line x1="30.5" y1="9.5" x2="33.5" y2="6.5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <line x1="34" y1="16" x2="38" y2="16" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <line x1="30.5" y1="22.5" x2="33.5" y2="25.5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <line x1="17.5" y1="9.5" x2="14.5" y2="6.5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <line x1="14" y1="16" x2="10" y2="16" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <line x1="17.5" y1="22.5" x2="14.5" y2="25.5" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <!-- Mountain/image indicator -->
              <rect x="6" y="30" width="36" height="14" rx="2" fill="none" stroke="currentColor" stroke-width="2"/>
              <path d="M6 44 L 14 36 L 22 40 L 30 32 L 42 42" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            <span class="ai-icon-label">Copy Image</span>
          </button>
          
          <button type="button" class="ai-icon-btn" data-action="replace-both" title="Copy prompt and image">
            <svg viewBox="0 0 48 48" aria-hidden="true" class="ai-icon">
              <!-- Combined: sun + squiggly lines -->
              <circle cx="30" cy="10" r="4" fill="currentColor"/>
              <line x1="30" y1="3" x2="30" y2="1" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="34.5" y1="5.5" x2="36.5" y2="3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="37" y1="10" x2="39" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="25.5" y1="5.5" x2="23.5" y2="3.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <line x1="23" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M6 22 Q 10 19, 14 22 T 22 22 T 30 22" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <path d="M6 28 Q 10 25, 14 28 T 22 28 T 30 28" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <path d="M6 34 Q 10 31, 14 34 T 22 34 T 30 34" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
              <path d="M6 40 Q 10 37, 14 40 T 22 40 T 30 40" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round"/>
            </svg>
            <span class="ai-icon-label">Copy Both</span>
          </button>
        </div>
      </section>

      <!-- Close button -->
      <button type="button" id="closeAiMenu" class="ai-menu-close" title="Close menu">
        <svg viewBox="0 0 24 24" aria-hidden="true">
          <path d="M18 6L6 18M6 6l12 12" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </button>
    </div>
  </div>

  <script src="version.js"></script>
  <script src="script.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('service-worker.js').catch(err => {
          console.log('Service worker registration failed:', err);
        });
      });
    }
  </script>
</body>
</html>